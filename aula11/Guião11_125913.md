# Guião11

### a)

- O Módulo de Message implementa uma interface simplificada para filas de mensagens System V. Este usa o mecanismo de IPC para fazer comunicação de processos sem relação, as mensagens enviadas pelo client são armazenadas numa fila gerenciada pelo kernel.\
Funcionamento de cada função:
```
msg_create(int key)
/*
1. Faz a system call msgget() com IPC_CREAT | IPC_EXECL
2. Cria uma nova fila de mensagens com a chave fornecida
3. Retorna um identificador único (msgid) para a fila criada
4. Se já existir fila com essa chave dá erro
*/
```

```
msg_connect(int key)
/*
1. Usa a system calll msgget() sem flags de criação
2. Conecta-se a uma fila já existente com a chave única dela
3. Retorna o identificador msgid() da fila já existente
*/
```

```
msg_destroy(int msgid)
/*
1. Usa a system call msgctl com a flag IPC_RMID
2. Remove permanentemente a fila do sistema
3. Libera todos os recursos do kernel
*/
```

```
int msg_send_nb(int msgid, void *msg, int size)
/*
1. Usa a system call msgsnd sem flag IPC_NOWAIT
2. Coloca a mensagem no final da fila
3. Se a fila estiver cheia ocorre block
*/
```

```
// BLOQUEANTE 
int msg_receive(int msgid, void *msg, int size, long dest)
/*
1. Usa msgrcv sem flag IPC_NOWAIT
2. Aguarda até que a mensagem do tipo 'rec' esteja disponivel
*/
```

```
// NÃO BLOQUEANTE
/*
int msg_receive_nb(int msgid, void *msg, int size, long dest, bool *msgrec)
1. Usa system call msgrcv com flag IPC_NOWAIT
2. Tenta receber mensagem do tipo 'rec'
3. Se houver mensagem: Copia para o buffer
4. Se não houver mensagem (fila vazia): Erro, retorna 0
*/
```

### b)

- 